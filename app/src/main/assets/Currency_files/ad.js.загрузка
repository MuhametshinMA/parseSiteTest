var adfox_conf = [
    {type:'d',id:'adfox_153130851584228147',p1:'cbiid',p2:'fxgs'},
    {type:'d',id:'adfox_154745510436632310',p1:'cdbvj',p2:'gfmh'},
    {type:'d',id:'adfox_154753620158919883',p1:'cdbyy',p2:'gfmh'},
    {type:'d',id:'adfox_15307043357052398',p1:'cbhgl',p2:'fxjr'},
    {type:'d',id:'adfox_15313097731482731',p1:'cbiiv',p2:'fyzz'},
    {type:'d',id:'adfox_153130911784644509',p1:'cbiig',p2:'fxgs'},
    {type:'d',id:'adfox_15313096979943314',p1:'cbiiu',p2:'fyzz'},
    {type:'d',id:'adfox_153130898920696268',p1:'cbiif',p2:'fxgs'},
    {type:'d',id:'adfox_153130962873067326',p1:'cbiit',p2:'fyzz'},
    {type:'d',id:'adfox_153191766286746516',p1:'cbjfq',p2:'fydv'},
    {type:'d',id:'adfox_153079167129513175',p1:'cbhja',p2:'fyzz'},
    {type:'d',id:'adfox_153079149836124156',p1:'cbhiz',p2:'fxgs'},
    {type:'d',id:'adfox_153131508309296696',p1:'cbijh',p2:'gaox'},
    {type:'d',id:'adfox_154745323743273321',p1:'cdbvh',p2:'gfml'},
    {type:'d',id:'adfox_154745810972565781',p1:'cdbvy',p2:'gfmy'},
    {type:'d',id:'adfox_154745772070466572',p1:'cdbvv',p2:'gfmx'},
    {type:'d',id:'adfox_154349620488465926',p1:'cctik',p2:'gept'},
    {type:'d',id:'adfox_154745722085396319',p1:'cdbvq',p2:'gfmh'},
    {type:'d',id:'adfox_155125262575592076',p1:'cdthb',p2:'fyyg'},
    {type:'d',id:'adfox_15597209068978486',p1:'cbvac',p2:'gcat'},
    {type:'d',id:'adfox_15623088754915494',p1:'cfphq',p2:'geti'},
    {type:'d',id:'adfox_15720089619328688',p1:'chpkx',p2:'gfdb'},
    {type:'d',id:'adfox_156560707475762683',p1:'cgkkk',p2:'gmwj'},
    {type:'d',id:'adfox_154745255307331527',p1:'cdbve',p2:'gfmd'},
    {type:'d',id:'adfox_154745289566762897',p1:'cdbvg',p2:'gfmj'},
    {type:'d',id:'adfox_15561875536476498',p1:'cends',p2:'gjqy'},
    {type:'d',id:'adfox_156717254360686236',p1:'cgtni',p2:'gjda'},
    {type:'d',id:'adfox_157416795651118254',p1:'chywo',p2:'gpxf'},
    {type:'d',id:'adfox_157380176754469545',p1:'chxfh',p2:'gfmi'},
    {type:'d',id:'adfox_157743446516692170',p1:'ciltr',p2:'fxjc'},
    {type:'d',id:'adfox_15809006960679533',p1:'civpz',p2:'fxjc'},
    {type:'d',id:'adfox_157769433957051344',p1:'cimfe',p2:'fxjc'},
    {type:'d',id:'adfox_15870468622364367',p1:'cjwqx',p2:'gjda'},
    {type:'d',id:'adfox_158763739732296027',p1:'ckaav',p2:'fxjc'},
    {type:'d',id:'adfox_158928760015564125',p1:'ckoou',p2:'fxjc'},
    {type:'d',id:'adfox_1589287503885384',p1:'ckoot',p2:'fxjc'},

    {type:'d',id:'adfox_15984276682092616',p1:'clzsm',p2:'fxjc'},
    { type: 'd', id: 'adfox_1598427711857853', p1: 'clzsn', p2: 'fxjc' },
    { type: 'd', id: 'adfox_160251376496442925', p1: 'cmqrr', p2: 'gjda' },
    { type: 'd', id: 'adfox_160516994051772873', p1: 'cnbna', p2: 'gjda' },

    { type: 'd', id: 'adfox_160864979665172476', p1: 'chywo', p2: 'gpxf' },

    { type: 'd', id: 'adfox_161051805622672911', p1: 'cnwsu', p2: 'fxjc' },

    { type: 'd', id: 'adfox_161354673366398590', p1: 'cofvw', p2: 'hcoe' },
    { type: 'd', id: 'adfox_16135468451502902', p1: 'cofwb', p2: 'hcof' },

    { type: 'd', id: 'adfox_161700784960165840', p1: 'cormn', p2: 'gjda' },
    { type: 'd', id: 'adfox_164691068404361539', p1: 'csxgc', p2: 'gcif' },

    // аукционы (не используются на данный момент) так же настройки находятся в
    // js/adfox_bidders.js {type:'a',id:'adfox_154591754029911298', p1:'cdapr',
    // p2:'y', d:['phone'], w:921}, {type:'a',id:'adfox_154592311509057429',
    // p1:'cdapt', p2:'y', d:['phone'], w:921},
    // {type:'a',id:'adfox_156380541336516418', p1:'cfyis', p2:'y',
    // d:['phone'], w:921},
];

var already_load = [];

function createAdfox(conf){
    var t = $("#"+conf.id);
    if(t.length){
        t.empty();
        window.yaContextCb.push(()=>{
            Ya.adfoxCode.create({
                ownerId: 271489,
                containerId: conf.id,
                params: {
                    p1: conf.p1,
                    p2: conf.p2
                },
                onRender: function (data) {
                    let banners = ['adfox_15299260376398129', 'adfox_152992761687945500', 'adfox_153191757739629999', 'adfox_155386757005716570']
                    let removeChat = banners.includes(conf.id)
                    if(removeChat) {
                        $('.load-block-webim-chat').hide()
                        $(document).on('click', '.xxx-stretching__btn-close', function () {
                            $('.load-block-webim-chat').show()
                        })
                    }
                }
            });
        })
    }
}
function createAdaptiveAdfox(conf) {
    var t = $("#"+conf.id);
    if(t.length){
        t.empty();
        window.yaContextCb.push(()=>{
            // window.Ya.adfoxCode.createAdaptive({
            Ya.adfoxCode.createAdaptive({
                ownerId: 239538,
                containerId: conf.id,
                params: {
                    p1: conf.p1,
                    p2: conf.p2
                },
                onRender: function (data) {
                    let banners = ['adfox_15299260376398129', 'adfox_152992761687945500', 'adfox_153191757739629999', 'adfox_155386757005716570']
                    let removeChat = banners.includes(conf.id)
                    if(removeChat) {
                        $('.load-block-webim-chat').hide()
                        $(document).on('click', '.xxx-stretching__btn-close', function () {
                            $('.load-block-webim-chat').show()
                        })
                    }
                }
            }, conf.d, {
                tabletWidth: conf.w,
                phoneWidth: 480,
                isAutoReloads: false
            });
        })
    }
}
function removeEmpty(t){
    setTimeout(function () {
        if(t.is(':empty')){
            var elem = t;
            if(t.parent().hasClass('g_ban_bot') || t.parent().hasClass('xxx-g-ban-bankiros'))
                elem = t.parent();

            elem.removeClass();
        }
    }, 5000);
}

$(window).on('load', function(){
    setTimeout(function(){
        createAdfox({type:'d',id:'adfox_15299260376398129',p1:'cbfrc',p2:'fxjj'});
        createAdfox({type:'d',id:'adfox_152992761687945500',p1:'cbfrd',p2:'fxkk'});
        createAdfox({type:'d',id:'adfox_153191757739629999',p1:'cbjfp',p2:'fydv'});
        createAdfox({type:'d',id:'adfox_155386757005716570',p1:'cbjmg',p2:'gave'});
    }, 1000);

    adfox_conf.forEach(function (conf) {
        if (conf.type === 'a') {
            createAdaptiveAdfox(conf);
        } else {
            createAdfox(conf);
        }
    });
});

function adfoxObserver(selector) {
    addLazyEvent(
        selector,
        function (t, observer) {
            if (t.isIntersecting) {
                var lazyAdfox = t.target;

                if(typeof t.target != "undefined"){
                    t = $(t.target);
                }
                var id = t.attr('id');
                if(already_load.indexOf(id) === -1) {
                    already_load.push(id);

                    //проверяем на автогенерацию id контейнра, как на пример в новостях
                    if( typeof t.attr('data-auto-generate-id') !== typeof undefined && t.attr('data-auto-generate-id') !== false ){
                        var conf = { type:'d',id:id, p1:t.attr('data-p1'), p2:t.attr('data-p2') };
                        createAdfox(conf);
                        removeEmpty(t);
                        return true;
                    }

                    adfox_conf.forEach(function (conf) {
                        if (id === conf.id) {
                            if (conf.type === 'a') {
                                createAdaptiveAdfox(conf);
                            } else {
                                createAdfox(conf);
                            }
                            removeEmpty(t);
                        }
                    });

                }
                observer.unobserve(lazyAdfox);
            }
        }
    );
}

/*перезагрузка обсервера после ajax*/
$(document).on('pjax:success', function(event, data, status, xhr, options) {
    already_load.length = 0;
    if( (xhr && xhr.responseText.indexOf('adfox_1') >= 0) || (data && data.indexOf('adfox_1') >= 0) ) {
        adfoxObserver('[id^=adfox_1]:empty');
    }
});
